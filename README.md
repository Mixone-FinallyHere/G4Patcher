# Pokemon Gen 4 Code Injection Patcher

This is a small thing ive written up to easily distribute .asm patches for code injecting things such as EV+IV-checking and Portable PC routines, because i was tired of explaining and writing out every patch separately.

This program is purely cli. It prompts you to select an unpacked ROM folder (such as one generated by [DSPRE](https://github.com/Mixone-FinallyHere/DS-Pokemon-Rom-Editor/tree/v1.13.1-beta)), then one of the included patches, then checks for:
1. Is the patch compatible with your game? (by comparing game header with patch name, so if you want to contribute your own patches, make sure to label your patches corrrectly)
2. Can you even inject the patch, i.e. is your arm9 expanded?
3. Is there free space in the synthOverlay and where is said space

After checking these things, it adjusts the patch file with the corrected injection address and runs the patch through armips.

An [armips](https://github.com/Kingcom/armips) binary is bundled into the release, so no need to install anything!

## 1. Usage:

### CLI

1. Download the latest [release](https://github.com/KalaayPT/g4patcher/releases)
2. Run G4Patcher
3. Select your unpacked ROM folder
4. Select the patch
5. If everything is fine, youll get a confirmation message, if not, you'll get a message telling you what the issue is
6. Press Enter to close

### GUI

1. Download the latest [release](https://github.com/KalaayPT/g4patcher/releases)
2. Run G4Patcher in GUI mode: `bash./g4patcher --gui`
3. Click "Select ROM Folder" to choose your unpacked ROM folder
4. Click "Select Patch File" to choose a patch (automatically filters to .asm files in the appropriate game directory)
5. Click "Apply Patch" to process
6. View the status message for success or errors
7. Close the window when done

## 2. Limitations:

- The program doesn't check if the patch is already applied, so if you apply a patch twice, it will duplicate the previous one. The patch will still work, but more space in your synthOverlay will be used up.
- The program doesnt check compression either (yet), so make sure that the hook overlay required by the patch is not compressed. 

## 3. Included patches:

can now be found [in the wiki](https://github.com/KalaayPT/G4Patcher/wiki/Included-Patches)

## 4. Build Instructions:

1. Install Rust and Cargo: Follow the instructions at https://www.rust-lang.org/tools/install
2. Clone the repository:
```bash
git clone https://github.com/KalaayPT/G4Patcher.git
cd G4Patcher
```
3. Build the project:
```bash
cargo build --release
```
4. Find the executable in target/release/g4patcher
5. Run the CLI or GUI as described in the Usage sections

## 5. Contributing:

If you want to contribute your own patches, you can use the included ones as templates as to what yours are supposed to look like. 

Make sure that:
1. The patch name is clearly labeled with the ROM it is to be applied to (such as "_HG" or "_PLAT")
2. The patch includes this type of structure (only for code injection patches):
```asm
INJECT_ADDR equ 0x023C8000

...

.ifdef PATCH
// hook here
.endif

...

.ifdef PREASSEMBLE
.create "temp.bin", 0x023C8000
.elseifdef PATCH
.open "unpacked/synthOverlay/0000", 0x023C8000  // 0000 for hg, 0009 for plat
.endif

.org INJECT_ADDR
```
so that the script is able to adjust the injection address and preassemble to calculate patch size.